<!doctype html>
<html lang="vi" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>ƒêƒÉng nh·∫≠p</title>

    <link rel="stylesheet" href="assets/css/ui.css" />
    <link rel="icon" href="assets/img/favicon.ico" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>

    <!-- Toast -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  </head>

  <body
    class="min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900"
  >
    <div
      class="w-full max-w-sm bg-white dark:bg-gray-900 rounded-2xl shadow-2xl p-6 relative"
    >
      <!-- Dark mode toggle -->
      <button
        id="themeToggle"
        onclick="toggleDarkMode()"
        class="absolute top-4 right-4 text-xl"
      >
        üåô
      </button>

      <div class="flex flex-col items-center mb-6">
        <img src="assets/img/logo.png" class="h-20 mb-4" alt="Nh·∫≠t Minh" />
        <p class="text-sm text-gray-500 dark:text-gray-400">
          S·∫°ch ‚Äì Th∆°m ‚Äì An to√†n
        </p>
      </div>

      <div class="mb-4">
        <label class="text-sm">T√†i kho·∫£n</label>
        <input id="username" class="ui-input" />
      </div>

      <div class="mb-4">
        <label class="text-sm">M·∫≠t kh·∫©u</label>
        <input id="password" type="password" class="ui-input" />
      </div>

      <label class="flex items-center gap-2 text-sm mb-4">
        <input id="rememberMe" type="checkbox" />
        Ghi nh·ªõ t√†i kho·∫£n
      </label>

      <button id="loginBtn" class="w-full ui-btn ui-btn-primary">
        ƒêƒÉng nh·∫≠p
      </button>

      <p class="text-xs text-center text-gray-400 mt-6">¬© 2026 Nh·∫≠t Minh</p>
    </div>

    <!-- ================= CORE (ƒê√öNG PATH) ================= -->

    <script src="core/config.js"></script>
    <script src="core/storage.js"></script>
    <script src="ui/theme.js"></script>
    <script src="ui/toast.js"></script>

    <!-- ================= LOGIN LOGIC ================= -->
    <script>
      const btn = document.getElementById("loginBtn");

      async function handleLogin() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const remember = document.getElementById("rememberMe").checked;

        if (!username || !password) {
          showToast("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin", "error");
          return;
        }

        btn.disabled = true;
        btn.textContent = "‚è≥ ƒêang ƒëƒÉng nh·∫≠p...";

        try {
          const res = await fetch(API + "/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });

          if (!res.ok) {
            showToast("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u", "error");
            return;
          }

          const data = await res.json();
          storage.set("access_token", data.access_token);
          storage.set("refresh_token", data.refresh_token);
          // ‚úÖ ƒë√°nh d·∫•u login th√†nh c√¥ng
          localStorage.setItem("login_notice", "1");

          if (remember) {
            storage.set("remember_username", username);
          } else {
            storage.remove("remember_username");
          }

          location.replace("./");
        } finally {
          btn.disabled = false;
          btn.textContent = "ƒêƒÉng nh·∫≠p";
        }
      }

      btn.addEventListener("click", handleLogin);

      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleLogin();
      });

      // ===============================
      // Restore remembered username
      // ===============================
      const remembered = storage.get("remember_username");
      if (remembered) {
        document.getElementById("username").value = remembered;
        document.getElementById("rememberMe").checked = true;
      }
      // ===============================
      // Show logout notice
      // ===============================
      if (localStorage.getItem("logout_notice")) {
        localStorage.removeItem("logout_notice");
        showToast("ƒê√£ ƒëƒÉng xu·∫•t", "info");
      }
    </script>
  </body>
</html>
